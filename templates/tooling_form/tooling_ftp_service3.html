
<!DOCTYPE html>
<html style="overflow-x:auto;overflow-y:auto;">
<head>
	<title>机构列表</title>
	
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=9,IE=10" />
<meta http-equiv="Expires" content="0">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Cache-Control" content="no-store">
<script>var d = "";</script>
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<!-- 设置浏览器图标 -->
<link rel="shortcut icon" href= "{{ static ('/ani/static/favicon.ico') }}">
<!-- 引入jeeplus ajax版本库文件，该文件压缩了jQuery，datatime等常用js文件以提高加载速度 -->
<link rel="stylesheet" href= "{{ static ('/ani/static/common/css/vendor.css') }}" />
<script src= "{{ static ('/ani/static/common/js/vendor.js') }}"></script>
<!-- 引入依赖的第三方插件 -->
<link href= "{{ static ('/ani/static/plugin/awesome/4.4/css/font-awesome.min.css') }}" rel="stylesheet" />
<script src= "{{ static ('/ani/static/plugin/jquery-validation/1.14.0/jquery.validate.js') }}" type="text/javascript"></script>
<script src= "{{ static ('/ani/static/plugin/jquery-validation/1.14.0/localization/messages_zh.min.js') }}" type="text/javascript"></script>
<script src= "{{ static ('/ani/static/plugin/jquery-validation/1.14.0/validation-methods.js') }}" type="text/javascript"></script>
<link href= "{{ static ('/ani/static/plugin/icheck-1.x/skins/square/_all.css') }}" rel="stylesheet" />
<script src= "{{ static ('/ani/static/plugin/icheck-1.x/icheck.js') }}"></script>
<script type="text/javascript">

    $(document).ready(function(){
        $('input.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%' // optional
        });
    });


</script>
<!--省市区三级联动插件-->
<link href= "{{ static ('/ani/static/plugin/city-picker/css/city-picker.css') }}" rel="stylesheet" type="text/css"/>
<script src= "{{ static ('/ani/static/plugin/city-picker/js/city-picker.data.js') }}" type="text/javascript"></script>
<script src= "{{ static ('/ani/static/plugin/city-picker/js/city-picker.js') }}" type="text/javascript"></script>

<!-- 引入layer插件,当做独立组件使用，不使用layui模块，该版本修复了chrome下花屏的bug -->
<script src= "{{ static ('/ani/static/plugin/layui/layer/layer.js') }}"></script>
<script src= "{{ static ('/ani/static/plugin/layui/laytpl/laytpl.js') }}"></script>


<!--引入webuploader-->
<link rel="stylesheet" type="text/css" href= "{{ static ('/ani/static/plugin/webuploader-0.1.5/webuploader.css') }}">
<link rel="stylesheet" type="text/css" href= "{{ static ('/ani/static/plugin/webuploader-0.1.5/demo.css') }}">
<script type="text/javascript" src= "{{ static ('/ani/static/plugin/webuploader-0.1.5/webuploader.js') }}"></script>

<!-- 引入toastr -->
<link rel="stylesheet" type="text/css" href= "{{ static ('/ani/static/plugin/toastr/toastr.css') }}">
<script type="text/javascript" src= "{{ static ('/ani/static/plugin/toastr/toastr.min.js') }}"></script>

<!--引入select2-->
<link rel="stylesheet" type="text/css" href= "{{ static ('/ani/static/plugin/select2/css/select2.min.css') }}">
<link rel="stylesheet" type="text/css" href= "{{ static ('/ani/static/plugin/select2/css/select2-bootstrap.css') }}">
<script type="text/javascript" src= "{{ static ('/ani/static/plugin/select2/js/select2.min.js') }}"></script>
<script type="text/javascript" src= "{{ static ('/ani/static/plugin/select2/js/i18n/zh-CN.js') }}"></script>

<!-- 引入自定义文件 -->
<script type="text/javascript">var ctx = '/ani/a', ctxStatic='/ani/static';</script>
<link rel="stylesheet" id="theme" href= "{{ static ('/ani/static/common/css/app-blue.css') }}" />
<script src= "{{ static ('/ani/static/common/js/jeeplus.js') }}"></script>

	
	
	<meta name="decorator" content="ani"/>
	
<script>
	var $treeTable=null;  
	$(document).ready(function() {
		$treeTable=$('#treeTable').treeTable({  
	    	   theme:'vsStyle',	           
				expandLevel : 2,
				column:0,
				checkbox: false,
	            url:'/tooling_form/form_device_list_api/?parentId=',  
	            callback:function(item) { 
	            	var officeItemTpl= $("#officeItemTpl").html();
					item.typeLabel = jp.getDictLabel([{"id":"21","createBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"createDate":"2013-05-27 08:00:00","updateBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"updateDate":"2013-05-27 08:00:00","label":"公司","value":"1","sort":"60","dictType":{"id":"19"}},{"id":"22","createBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"createDate":"2013-05-27 08:00:00","updateBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"updateDate":"2013-05-27 08:00:00","label":"部门","value":"2","sort":"70","dictType":{"id":"19"}},{"id":"23","createBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"createDate":"2013-05-27 08:00:00","updateBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"updateDate":"2013-05-27 08:00:00","label":"小组","value":"3","sort":"80","dictType":{"id":"19"}},{"id":"24","createBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"createDate":"2013-05-27 08:00:00","updateBy":{"id":"1","loginFlag":"1","roleNames":"","admin":true},"updateDate":"2013-05-27 08:00:00","label":"其它","value":"4","sort":"90","dictType":{"id":"19"}}], item.type);
                    var result = laytpl(officeItemTpl).render(item);
	                return result;
	            },  
	            beforeClick: function($treeTable, id) { 
	                //异步获取数据 这里模拟替换处理  
	                $treeTable.refreshPoint(id);  
	            },  
	            beforeExpand : function($treeTable, id) {   
	            },  
	            afterExpand : function($treeTable, id) {  
	            	//layer.closeAll(); 
	            },  
	            beforeClose : function($treeTable, id) {    
	            	
	            }  
	        });  
	       
	});
	
	function del(con,id){  
		jp.confirm('确认要删除机构吗？', function(){
			jp.loading();
       	  	$.get("/ani/a/sys/office/delete?id="+id, function(data){
       	  		if(data.success){
       	  			$treeTable.del(id);
       	  			jp.success(data.msg);
       	  		}else{
       	  			jp.error(data.msg);
       	  		}
       	  	})
       	   
   		});

	} 
	
	function refresh(){//刷新
		var index = jp.loading("正在加载，请稍等...");
		$treeTable.refresh();
		jp.close(index);
	}
	function refreshNode(data) {
        var current_id = data.body.office.id;
        var target = $treeTable.get(current_id);
        var old_parent_id = target.attr("pid") == undefined?'0':target.attr("pid");
        var current_parent_id = data.body.office.parentId;
        var current_parent_ids = data.body.office.parentIds;

        if(old_parent_id == current_parent_id){
            if(current_parent_id == '0'){
                $treeTable.refreshPoint(-1);
            }else{
                $treeTable.refreshPoint(current_parent_id);
            }
        }else{
            $treeTable.del(current_id);//刷新删除旧节点
            $treeTable.initParents(current_parent_ids, "0");
        }
    }
</script>
<script type="text/html" id="officeItemTpl">
<td><a  href="#" onclick="jp.openViewDialog('查看机构', '/ani/a/sys/office/form?id={{d.id}}','800px', '600px')">{{d.name}}</a></td>

<td> {{d.area.name}} </td>
<td>{{d.code}}</td>
<td>{{d.typeLabel }}</td>
<td>{{d.remarks}}</td>
<td>
	<div class="btn-group">
 		<button type="button" class="btn  btn-primary btn-xs dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-cog"></i>
			<span class="fa fa-chevron-down"></span>
		</button>
	  <ul class="dropdown-menu" role="menu">
		
			<li><a href="#" onclick="jp.openViewDialog('查看机构', '/ani/a/sys/office/form?id={{d.id}}','800px', '600px')"  ><i class="fa fa-search-plus"></i>  查看</a></li>
		
		
			<li><a href="#" onclick="jp.openSaveDialog('修改机构', '/ani/a/sys/office/form?id={{d.id}}','800px', '600px')" ><i class="fa fa-edit"></i> 修改</a></li>
		
		
			<li><a  onclick="return del(this, '{{d.id}}')"><i class="fa fa-trash"></i> 删除</a></li>
		
		
			<li><a href="#" onclick="jp.openSaveDialog('添加下级机构', '/ani/a/sys/office/form?parent.id={{d.id}}','800px', '600px')"><i class="fa fa-plus"></i> 添加下级机构</a></li>
		
	  </ul>
	</div>
</td>
</script>

</head>
<body id="" class=""  style="">
	
	<div class="wrapper wrapper-content">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title">机构列表</h3>
			</div>
			
			<div class="panel-body">
			<!-- 工具栏 -->
			<div class="row">
			<div class="col-sm-12">
				<div class="pull-left treetable-bar">
					
						<a id="add" class="btn btn-primary"  onclick="jp.openSaveDialog('新增机构', '/ani/a/sys/office/form','800px', '600px')" ><i class="glyphicon glyphicon-plus"></i> 新建</a>
					
			       <button class="btn btn-default" data-toggle="tooltip" data-placement="left" onclick="refresh()" title="刷新"><i class="glyphicon glyphicon-repeat"></i> 刷新</button>
				
				</div>
			</div>
			</div>
		
			<table id="treeTable" class="table table-hover">
				<thead>
					<tr>
						<th>机构名称</th>
						<th>归属区域</th>
						<th>机构编码</th>
						<th>机构类型</th>
						<th>备注</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<br/>
			</div>
		</div>
	</div>

</body>
</html>